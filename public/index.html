<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–î–¢–ü –ú–æ—Å–∫–≤—ã ‚Äî –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/styles.css" rel="stylesheet">
</head>

<body>

<nav class="navbar navbar-expand-lg bg-white border-bottom shadow-sm px-4">
  <a class="navbar-brand d-flex align-items-center gap-2" href="#">
    <span class="brand-icon">üö¶</span>
    <span class="fw-bold text-dark">DTP Analytics</span>
  </a>
  <div class="ms-auto">
    <!-- ‚úÖ –ö–Ω–æ–ø–∫–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞ (–ø–æ–∫–∞–∂–µ–º —á–µ—Ä–µ–∑ JS) -->
    <button id="runAnalyzeBtn" class="btn btn-sm btn-warning me-2" style="display:none;">
      –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∞–ª–∏–∑
    </button>

    <button id="toggleMarkers" class="btn btn-sm btn-outline-secondary me-2">–ú–µ—Ç–∫–∏: –≤–∫–ª</button>
    <button id="logout" class="btn btn-sm btn-outline-danger">–í—ã–π—Ç–∏</button>
  </div>
</nav>

<div class="main-container">

  <div class="sidebar">
    <div class="card border-0 shadow-sm d-flex flex-column h-100">

      <div class="card-header bg-white border-0 pt-2 pb-0 flex-shrink-0 px-2">
        <ul class="nav nav-tabs nav-fill card-header-tabs" id="sidebarTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active small fw-bold"
                    id="analysis-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#tab-analysis"
                    type="button"
                    role="tab"
                    aria-controls="tab-analysis"
                    aria-selected="true">
              üìä –ê–Ω–∞–ª–∏–∑
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link small fw-bold"
                    id="route-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#tab-route"
                    type="button"
                    role="tab"
                    aria-controls="tab-route"
                    aria-selected="false">
              üöó –ú–∞—Ä—à—Ä—É—Ç
            </button>
          </li>
        </ul>
      </div>

      <div class="tab-content h-100 flex-grow-1">

        <div class="tab-pane fade show active h-100 p-0" id="tab-analysis" role="tabpanel" aria-labelledby="analysis-tab">
          <div class="d-flex flex-column h-100">

            <div class="p-3 border-bottom bg-white flex-shrink-0">
              <h6 class="fw-bold mb-0 text-uppercase text-muted small">–í—ã—è–≤–ª–µ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏</h6>
            </div>

            <div id="legend-container" class="flex-grow-1 overflow-auto p-3" style="background: #f8f9fa;"></div>

            <div id="cluster-info-panel" class="border-top p-3 bg-white flex-shrink-0" style="display: none;">
              <h6 id="cluster-title" class="fw-bold mb-1">...</h6>
              <div class="small text-muted mb-2" id="cluster-desc"></div>
              <button class="btn btn-sm btn-outline-primary w-100" id="btn-details">
                –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –î–¢–ü
              </button>
            </div>

          </div>
        </div>

        <div class="tab-pane fade h-100 p-0" id="tab-route" role="tabpanel" aria-labelledby="route-tab">
          <div class="d-flex flex-column h-100">

            <div class="p-3 border-bottom bg-white flex-shrink-0">
              <h6 class="fw-bold mb-0 text-uppercase text-muted small">–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞</h6>
            </div>

            <div class="p-3 bg-white border-bottom flex-shrink-0">
              <div class="mb-2">
                <label class="form-label small text-muted mb-1" for="routeFrom">–û—Ç–∫—É–¥–∞</label>
                <input id="routeFrom"
                       class="form-control"
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –¢–≤–µ—Ä—Å–∫–∞—è 1, –ú–æ—Å–∫–≤–∞"
                       autocomplete="off">
              </div>

              <div class="mb-2">
                <label class="form-label small text-muted mb-1" for="routeTo">–ö—É–¥–∞</label>
                <input id="routeTo"
                       class="form-control"
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ö—Ä–∞—Å–Ω–∞—è –ø–ª–æ—â–∞–¥—å, –ú–æ—Å–∫–≤–∞"
                       autocomplete="off">
              </div>

              <div class="d-flex gap-2 mt-3">
                <button id="buildRouteBtn" class="btn btn-primary flex-fill">–ü–æ—Å—Ç—Ä–æ–∏—Ç—å</button>
                <button id="clearRouteBtn" class="btn btn-outline-secondary">–û—á–∏—Å—Ç–∏—Ç—å</button>
              </div>

              <div id="routeError" class="text-danger small mt-2" style="display:none;"></div>
            </div>
            <div class="flex-grow-1 overflow-auto p-3" style="background:#f8f9fa;">
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="map-container">
    <div id="map"></div>
  </div>

</div>

<footer class="app-footer">
  –ò—Å—Ç–æ—á–Ω–∏–∫ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
  <a href="https://dtp-stat.ru/opendata" target="_blank" rel="noopener noreferrer">
    https://dtp-stat.ru/opendata
  </a>
</footer>

<div class="offcanvas offcanvas-end shadow" tabindex="-1" id="dtpDetails" style="width: 400px;">
  <div class="offcanvas-header border-bottom">
    <h5 class="offcanvas-title fw-bold" id="detailId">–î–¢–ü</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
  </div>
  <div class="offcanvas-body p-0">
    <div class="p-4 border-bottom bg-light">
      <div class="text-uppercase text-muted small fw-bold mb-1" id="detailCat">–¢–∏–ø</div>
      <h4 class="mb-2 fw-bold" id="detailSeverity">–¢—è–∂–µ—Å—Ç—å</h4>
      <div class="d-flex gap-2 mt-3">
        <div class="bg-white px-3 py-2 rounded shadow-sm border text-center flex-fill">
          <div class="h4 mb-0 text-danger fw-bold" id="detailInj">0</div><div class="small text-muted">–ü–æ—Å—Ç—Ä–∞–¥–∞–ª–æ</div>
        </div>
        <div class="bg-white px-3 py-2 rounded shadow-sm border text-center flex-fill">
          <div class="h4 mb-0 text-dark fw-bold" id="detailDead">0</div><div class="small text-muted">–ü–æ–≥–∏–±–ª–æ</div>
        </div>
      </div>
    </div>
    <div class="p-4">
      <div class="mb-4">
        <h6 class="fw-bold border-bottom pb-2 mb-3">üìç –î–∞–Ω–Ω—ã–µ</h6>
        <div class="mb-2"><span class="text-muted small d-block">–ê–¥—Ä–µ—Å</span><span class="fw-medium" id="detailAddr">‚Äî</span></div>
        <div class="mb-2"><span class="text-muted small d-block">–í—Ä–µ–º—è</span><span class="fw-medium" id="detailTime">‚Äî</span></div>
        <div class="mb-2"><span class="text-muted small d-block">–†–∞–π–æ–Ω</span><span class="fw-medium" id="detailRegion">‚Äî</span></div>
      </div>
      <div class="mb-4">
        <h6 class="fw-bold border-bottom pb-2 mb-3">üåß –£—Å–ª–æ–≤–∏—è</h6>
        <div class="mb-2"><span class="text-muted small d-block">–ü–æ–≥–æ–¥–∞</span><div id="detailWeather" class="d-flex flex-wrap gap-1 mt-1"></div></div>
        <div class="mb-2"><span class="text-muted small d-block">–î–æ—Ä–æ–≥–∞</span><div id="detailRoad" class="d-flex flex-wrap gap-1 mt-1"></div></div>
        <div class="mb-2"><span class="text-muted small d-block">–°–≤–µ—Ç</span><span class="fw-medium" id="detailLight">‚Äî</span></div>
      </div>
      <div class="mb-4">
        <h6 class="fw-bold border-bottom pb-2 mb-3">üèô –û–∫—Ä—É–∂–µ–Ω–∏–µ</h6>
        <div id="detailNearby" class="d-flex flex-wrap gap-1"></div>
      </div>
      <div class="d-flex justify-content-between text-muted small border-top pt-3">
        <div>–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤: <span class="fw-bold text-dark" id="detailPart">0</span></div>
        <div>ID: <span class="font-monospace" id="detailSourceId">‚Äî</span></div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://api-maps.yandex.ru/2.1/?apikey=9e226a60-c4ba-4fd7-a1ba-eb528cb89743&suggest_apikey=3379a8e4-63cc-4dd9-9619-d21cf44c3c32&lang=ru_RU&load=package.full,SuggestView"></script>
<script type="module" src="/js/main.js"></script>
</body>
</html>
